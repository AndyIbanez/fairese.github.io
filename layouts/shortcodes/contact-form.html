<form id="contact-form" class="space-y-4" novalidate>
  <div>
    <label>Name</label>
    <input type="text" name="name" required class="w-full" autocomplete="name">
  </div>
  <div>
    <label>Email</label>
    <input type="email" name="email" required class="w-full" autocomplete="email">
  </div>
  {{ if .Page.Params.form_show_project_type }}
  <div>
    <label for="project_type">Project Type</label>
    <select name="project_type" id="project_type" required class="w-full">
      <option value="iOS Development">iOS Development</option>
      <option value="Consulting">Consulting</option>
      <option value="n8n Automation">n8n Automation</option>
       <option value="Something Else">Something Else</option>
    </select>
  </div>
{{ end }}
{{ if .Page.Params.form_show_app }}
  <div>
    <label for="app_name">App</label>
    <select name="app_name" id="app_name" required class="w-full">
      <option value="">-- Please select an app --</option>
      <option value="Silvianna">Silvianna</option>
    </select>
  </div>
{{ end }}
  <div>
    <label>Message</label>
    <textarea name="message" rows="6" required class="w-full"></textarea>
  </div>

  <input type="text" name="company" autocomplete="off" tabindex="-1"
         style="position:absolute;left:-50000px" aria-hidden="true">

  <!-- Turnstile -->
  <div class="cf-turnstile"
       data-sitekey='{{ .Site.Params.turnstileSiteKey }}'
       data-action="contact"
       data-theme="auto"></div>

  <button type="submit">Send</button>
  <p id="contact-status" aria-live="polite" class="text-sm mt-2"></p>
</form>

<script defer src="https://challenges.cloudflare.com/turnstile/v0/api.js"></script>
<script>
(() => {
  const form = document.getElementById('contact-form');
  const status = document.getElementById('contact-status');

  // Determine API base URL based on environment
  let apiBase;
  if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
    apiBase = 'https://fairese.com'; // always test against live domain from localhost
  } else if (location.hostname === 'fairese.com' || location.hostname === 'www.fairese.com') {
    apiBase = location.origin; // keep exact origin (with or without www)
  } else {
    // fallback — in case the site is running on some staging host
    apiBase = 'https://fairese.com';
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    status.textContent = 'Sending…';

    const fd = new FormData(form);
    const payload = Object.fromEntries(fd.entries()); // includes cf-turnstile-response

    try {
      const res = await fetch(`${apiBase}/api/contact`, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload),
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data.error || 'Request failed');

      status.textContent = data.message || 'Message sent. Thank you!';
      form.reset();
      if (window.turnstile) turnstile.reset();
    } catch (err) {
      console.error('Form submission error:', err);
      status.textContent = 'Something went wrong. Please try again.';
    }
  });
})();
</script>